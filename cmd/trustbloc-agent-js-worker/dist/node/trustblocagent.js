!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TrustBlocAgent=t():e.TrustBlocAgent=t()}(global,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="dist/node/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"Framework",(function(){return i}));const{loadWorker:r}=n(1);async function o(e,t,n,r,o,i){return new Promise((s,a)=>{const c=setTimeout(e=>a(new Error(i)),2e4);let u=o;"string"==typeof o&&(u=JSON.parse(o));const l=function(e,t,n){return{id:Math.random().toString(36).slice(2),pkg:e,fn:t,payload:n}}(n,r,u);t.set(l.id,e=>{clearTimeout(c),e.isErr&&a(new Error(e.errMsg)),s(e.payload)}),e.postMessage(l)})}const i=class{constructor(e){return s(e)}},s=function(e){if(!e)throw new Error("trustblocagent: missing options");if(!e.assetsPath)throw new Error("trustblocagent: missing assets path");const t=new Map,n=new Map,i={_test:{_echo:async function(e){return new Promise((t,r)=>{o(s,n,"test","echo",{echo:e},"_echo() timed out").then(e=>t(e.echo),e=>r(new Error("trustbloc agent: _echo() failed. error: "+e.message)))})}},destroy:async function(){var e=await o(s,n,"trustblocagent","Stop","{}","timeout while stopping trustbloc agent");return s.terminate(),s=null,e},didclient:{pkgname:"didclient",createDID:async function(e){return o(s,n,this.pkgname,"CreateDID",e,"timeout while creating did")},saveDID:async function(e){return o(s,n,this.pkgname,"SaveDID",e,"timeout while saving did")}},credentialclient:{pkgname:"credentialclient",saveCredential:async function(e){return o(s,n,this.pkgname,"SaveCredential",e,"timeout while saving credential")}},presentationclient:{pkgname:"presentationclient",savePresentation:async function(e){return o(s,n,this.pkgname,"SavePresentation",e,"timeout while saving presentation")}}};var s=r(n,t,{dir:e.assetsPath,wasm:e.assetsPath+"/trustbloc-agent-js-worker.wasm",wasmJS:e.assetsPath+"/wasm_exec.js"});return new Promise((r,a)=>{const c=setTimeout(e=>a(new Error("timout waiting for trustbloc agent to initialize")),1e4);t.set("asset-ready",async t=>{clearTimeout(c),o(s,n,"trustblocagent","Start",e,"timeout while starting trustbloc agent").then(e=>r(i),e=>a(new Error(e.message)))})})}},function(e,t,n){"use strict";n.r(t),n.d(t,"loadWorker",(function(){return o}));const{Worker:r}=n(2);function o(e,t,n){const o=n.wasmJS,i=n.wasm,s=n.dir+"/worker-impl-node.js",a=new r(s,{workerData:{wasmJS:o,wasmPath:i}});return a.on("message",n=>{if(n.topic)return void(t.get(n.topic)?t.get(n.topic)(n):t.get("all")?t.get("all")(n):console.log("no subscribers found for this topic",n.topic));const r=e.get(n.id);e.delete(n.id),r(n)}),a}},function(e,t){e.exports=require("worker_threads")}])}));